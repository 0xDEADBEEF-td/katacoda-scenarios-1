In this step, we will run a bigger benchmark and run out of space to show how easy it is to add space to a volume dynamically.

### Step: Run benchmark to make the database run out of space

Open a shell inside of your container.
```
POD=`kubectl get pods -l app=postgres | grep Running | awk '{print $1}'`
kubectl exec -it $POD bash
```{{execute T1}}

Use pgbench to run a baseline transaction benchmark which will try to grow the volume to more than 1 Gib and fail.

```
pgbench -c 10 -j 2 -t 10000 pxdemo
```{{execute T1}}

* You will see a lot of error messages, if you look at the first one it will say "No space left on device". The pod is going to fail but that's ok, we'll let STORK reschedule it. If the pod doesn't faile you will have to ```exit```{{execute T1}} from the pod shell before proceeding.

### Step: Expand the volume and run benchmark again

Note that this version of kubernetes doesn't support modifying the PVC after creation so we have to do this operation directly on Portworx with the pxctl cli tool. With Kubernetes 1.11 you will be able to simply modify the PVC to add more data (have to define the storage class with allowVolumeExpansion: true). 

Inspect the volume:
```
VOL=`kubectl get pvc | grep px-postgres-pvc | awk '{print $3}'`
PX_POD=$(kubectl get pods -l name=portworx -n kube-system -o jsonpath='{.items[0].metadata.name}')
kubectl exec -it $PX_POD -n kube-system -- /opt/pwx/bin/pxctl volume inspect ${VOL} 
```{{execute T1}}

As you can see the volume is within 10% of full and so we need to expand it using the following command:
```
kubectl exec -it $PX_POD -n kube-system -- /opt/pwx/bin/pxctl volume update -size=2 ${VOL}
```{{execute T1}}

Now that you have expanded the volume you can go back to the step above and run the benchmark again.
